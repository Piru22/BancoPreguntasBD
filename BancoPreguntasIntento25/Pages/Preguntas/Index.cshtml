@page
@model BancoPreguntasIntento25.Pages.Preguntas.IndexModel
@{
    ViewData["Title"] = "Banco de Preguntas";
    ViewData["HideNav"] = true;   // ← barra vacía (sin marca ni links)
}

<div class="container-wide">

    <h1 class="page-title">Banco de Preguntas</h1>

    <div class="status-legend">
        <span class="legend-item">
            <span class="sq sq-green"></span> Completa (5 unidades)
        </span>
        <span class="legend-item">
            <span class="sq sq-yellow"></span> Medio incompleta (3–4 unidades)
        </span>
        <span class="legend-item">
            <span class="sq sq-red"></span> Incompleta (1–2 unidades)
        </span>
    </div>

    <div class="toolbar">
        <div class="toolbar-left">
            <!-- tu enlace existente, ahora con estilo btn -->
            <a asp-page="./Create" class="btn btn-primary">➕ Nueva Pregunta</a>

            <!-- tus botones de flujo, respetando rutas -->
            <a asp-page="/Preguntas/Asignaturas" class="btn btn-ghost">📚 Ver asignaturas</a>
            <a asp-page="/Preguntas/VerRespuestas" class="btn btn-ghost">👁️ Ver preguntas</a>
            <a asp-page="/Estadisticas/Estadistica" class="btn btn-ghost">📊 Ver estadísticas</a>
            <a asp-page="/CuentaUsuarios/Profesor" class="btn btn-ghost">👨‍🏫 Ver profesores</a>

        </div>

        <div class="toolbar-right">
            <!-- tu filtro GET, mismos nombres/valores -->
            <form method="get" style="display:flex; gap:10px; align-items:center;">
                <div class="search">
                    <input type="number"
                           name="Unidad"
                           value="@(Model.Unidad?.ToString() ?? "")"
                           placeholder="Buscar por unidad..." />
                </div>
                <button type="submit" class="btn btn-primary">Filtrar</button>
                <a asp-page="./Index" class="btn btn-ghost">Limpiar</a>
            </form>
        </div>
    </div>

    @if (Model.Unidad.HasValue)
    {
        <div style="margin-bottom:10px; color:var(--muted);">
            Mostrando resultados de la <strong>Unidad @Model.Unidad</strong>.
        </div>
    }

    <table class="table-bank">
        <thead>
            <tr>
                <th>@Html.DisplayNameFor(model => model.ListaPreguntas[0].Texto)</th>
                <th>@Html.DisplayNameFor(model => model.ListaPreguntas[0].RespuestaCorrecta)</th>
                <th>@Html.DisplayNameFor(model => model.ListaPreguntas[0].Asignatura)</th>
                <th>@Html.DisplayNameFor(model => model.ListaPreguntas[0].Unidad)</th>
                <th>@Html.DisplayNameFor(model => model.ListaPreguntas[0].SubUnidad)</th>
                <th style="width:240px;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.ListaPreguntas)
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => item.Texto)</td>
                    <td>@Html.DisplayFor(modelItem => item.RespuestaCorrecta)</td>

                    <!-- Celda reemplazada: Asignatura + indicador de estado -->
                    <td>
                        <span class="chip">@item.Asignatura</span>
                        @{
                            var key = (item.Asignatura ?? string.Empty).Trim();
                            var unidades = Model.UnidadesPorAsignatura.TryGetValue(key, out var c) ? c : 0;

                            var statusClass = unidades >= 4 ? "sq-green"
                                             : unidades == 3 ? "sq-yellow"
                                             : "sq-red";

                            var estadoTxt = unidades >= 4 ? "Completa"
                                          : unidades == 3 ? "Medio completa"
                                          : "Incompleta";
                        }
                        <span class="sq @statusClass" title="@($"{unidades} unidad(es) — {estadoTxt}")"></span>
                    </td>

                    <td><span class="chip">@Html.DisplayFor(modelItem => item.Unidad)</span></td>
                    <td><span class="chip">@Html.DisplayFor(modelItem => item.SubUnidad)</span></td>
                    <td>
                        <div class="actions">
                            <a asp-page="./Edit" asp-route-id="@item.PreguntaId" class="btn btn-ghost">✏️ Editar</a>
                            <a asp-page="./Details" asp-route-id="@item.PreguntaId" class="btn btn-ghost">📄 Detalles</a>
                            <a asp-page="./Delete" asp-route-id="@item.PreguntaId" class="btn btn-danger">🗑 Borrar</a>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>

</div>
